---
title: ä¸ªäººåšå®¢æ”¯æŒç•™è¨€è¯„è®ºï¼Œæ¥çœ‹çœ‹ Hexo Diversity ä¸»é¢˜å¦‚ä½•å®ç°çš„ï¼
date: 2025-05-08 20:03:15
updated: 2025-05-08 20:03:15
categories:
  - åšå®¢æ¡†æ¶-Hexo
tags:
  - Hexo
  - Diversity
  - hexo-theme-diversity
  - ç•™è¨€è¯„è®º
  - Utterances
  - Gitalk
  - Giscus
---

![](/images/diversity-logo.png)

# ğŸ“– å‰è¨€

ç»è¿‡å‰é¢å‡ ç¯‡æ–‡ç« [ã€Šåšå®¢æ¡†æ¶-Hexoã€‹](https://blog.huazie.com/?path=/categories/%E5%8D%9A%E5%AE%A2%E6%A1%86%E6%9E%B6-Hexo/)çš„ä»‹ç»ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»èƒ½å¤Ÿåˆ›å»ºå±äºè‡ªå·±çš„ä¸ªäººåšå®¢ï¼Œå¹¶å°† **Hexo Diversity** ä¸»é¢˜åº”ç”¨åˆ°è‡ªå·±çš„åšå®¢ä¸­äº†ã€‚

é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥å°±è·Ÿç€ **Huazie** ä¸€èµ·æ·±å…¥äº†è§£ä¸‹ **Diversity** æ˜¯å¦‚ä½•æ”¯æŒç•™è¨€è¯„è®ºçš„ï¼Ÿ

<!-- more -->

# ğŸ—¨ï¸ è¯„è®ºæ¶æ„

**Diversity** ä¸»é¢˜é‡‡ç”¨æ¨¡å—åŒ–æ–¹æ¡ˆé›†æˆå¤šç§è¯„è®ºç³»ç»Ÿã€‚ç”¨æˆ·å¯å¯ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç³»ç»Ÿï¼Œå½“å¯ç”¨å¤šä¸ªæ—¶ï¼Œç³»ç»Ÿå°†ä»¥æ ‡ç­¾é¡µå½¢å¼å‘ˆç°ï¼Œå…è®¸è®¿å®¢é€‰æ‹©è‡ªå·±åå¥½çš„è¯„è®ºç³»ç»Ÿã€‚

![](comment-system-architecture.png)

åœ¨æ·±å…¥äº†è§£ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ [Diversity V2.3.4](https://github.com/huazie/hexo-theme-diversity/releases/tag/v2.3.4) ç›®å‰é›†æˆçš„è¯„è®ºç³»ç»Ÿéƒ½æœ‰å“ªäº›ï¼Ÿ

*   `Utterance` ï¼šä¸€ä¸ªç”±å¼€æºç¤¾åŒºæ„å»ºçš„è¯„è®ºæ’ä»¶ï¼Œå®ƒæä¾›äº†ä¸€ç§åœ¨åšå®¢ã€æ–‡ç« æˆ–ä»»ä½•é™æ€ç½‘ç«™ä¸Šæ·»åŠ äº’åŠ¨å¼è¯„è®ºåŠŸèƒ½çš„é«˜æ•ˆè§£å†³æ–¹æ¡ˆã€‚å®ƒæ‰€æœ‰çš„è¯„è®ºæ•°æ®å­˜å‚¨äºç”¨æˆ·æŒ‡å®šçš„**GitHub**å…¬å¼€ä»“åº“çš„**Issues**ä¸­ï¼Œæ¯ä¸ªç½‘é¡µå¯¹åº”ä¸€ä¸ª**Issue**ï¼Œ**è¯„è®º**å³**Issueä¸‹çš„ç•™è¨€**ã€‚æ›´å¤šä¿¡æ¯æŸ¥çœ‹ï¼š[utteranc.es](https://utteranc.es)
*   `Gitalk` ï¼šä¸€ä¸ªåŸºäº**GitHub Issue**å’Œ**Preact**å¼€å‘çš„ç°ä»£è¯„è®ºæ’ä»¶ã€‚å®ƒå…è®¸ç½‘ç«™è®¿å®¢ä½¿ç”¨**GitHub**è´¦å·ç™»å½•å¹¶å‘è¡¨è¯„è®ºï¼Œæ‰€æœ‰è¯„è®ºæ•°æ®éƒ½å‚¨å­˜åœ¨ç›¸åº”çš„**GitHub**ä»“åº“ä¸­ã€‚æ›´å¤šä¿¡æ¯æŸ¥çœ‹ï¼š[gitalk.github.io](https://gitalk.github.io)
*   `Giscus` ï¼šä¸€ä¸ªåˆ©ç”¨ **GitHub Discussions** å®ç°çš„è¯„è®ºç³»ç»Ÿï¼Œå®ƒæ‰€æœ‰çš„è¯„è®ºæ•°æ®å­˜å‚¨äº **GitHub** å…¬å¼€ä»“åº“çš„ **Discussions**ï¼ˆè®¨è®ºåŒºï¼‰ä¸­ï¼Œæ¯ä¸ªç½‘é¡µå¯¹åº”ä¸€ä¸ª **Discussion**ï¼Œè¯„è®ºå³ **Discussion** ä¸‹çš„å›å¤ã€‚

ç›¸ä¿¡å¤§å®¶ä¹Ÿçœ‹åˆ°äº†ï¼Œ**Huazie** é€‰ç”¨çš„è¯„è®ºç³»ç»Ÿå‡æ˜¯æ·±åº¦æ•´åˆ **GitHub** ç”Ÿæ€ï¼Œåªéœ€è¦ç™»å½• **GitHub** è´¦å·å°±å¯ä»¥ç•™è¨€ï¼

ç›¸è¾ƒäºä¼ ç»Ÿè¯„è®ºå·¥å…·éœ€è¦è‡ªå»ºæ•°æ®åº“ï¼ˆçŠ¹å¦‚å…»äº†ä¸€åª"åé‡‘å…½"ï¼Œæ—¢è´¹é’±åˆå¾—å¤©å¤©æ“å¿ƒæœåŠ¡å™¨ç»´æŠ¤ï¼‰ï¼Œæˆ–æ˜¯å¿å—æ»¡å±å¹¿å‘Šçš„ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ŒåŸºäº**GitHub**å¼€å‘çš„è¯„è®ºç³»ç»Ÿå±•ç°å‡ºäº†å®ƒä»¬çš„ä¼˜åŠ¿ï¼š

*   **æ— éœ€ç‹¬ç«‹æœåŠ¡å™¨æ”¯æŒ**
*   **é›¶ç»´æŠ¤æˆæœ¬**
*   **ç•Œé¢çº¯å‡€æ— å¹¿å‘Š**

# ğŸ“„ å®ç°ç»†èŠ‚

## 1. è¯„è®ºç›¸å…³é…ç½®

### 1.1 é€šç”¨è¯„è®ºé…ç½®

ä¸»è¯„è®ºç³»ç»Ÿé…ç½®ä½äº [\_config.yml](https://github.com/huazie/hexo-theme-diversity/blob/main/_config.yml) æ–‡ä»¶ä¸­ï¼š

```yml
comments:
  style: tabs
  active:
  storage: true
  lazyload: false
  nav:
    #utterances:
    #  text: Utterances
    #  order: 0
    #gitalk:
    #  order: 1
```

**é…ç½®é¡¹è¯´æ˜**

*   `style`: å¤šè¯„è®ºç³»ç»Ÿçš„æ˜¾ç¤ºæ–¹å¼ï¼ˆç›®å‰  [Diversity V2.3.4](https://github.com/huazie/hexo-theme-diversity/releases/tag/v2.3.4) ç‰ˆæœ¬ä»…æ”¯æŒ `tabs` æ ‡ç­¾é¡µæ¨¡å¼ï¼‰
*   `active`: é»˜è®¤æ¿€æ´»çš„è¯„è®ºç³»ç»Ÿåç§°ï¼ˆéœ€ä¸ä¸‹æ–¹ç‹¬ç«‹é…ç½®çš„è¯„è®ºç³»ç»Ÿåä¸€è‡´ï¼‰
*   `storage`: æ˜¯å¦é€šè¿‡æµè§ˆå™¨æœ¬åœ°å­˜å‚¨è®°å½•è®¿å®¢ä¸Šæ¬¡é€‰æ‹©çš„è¯„è®ºç³»ç»Ÿ
*   `lazyload`: æ˜¯å¦å»¶è¿ŸåŠ è½½è¯„è®ºç³»ç»Ÿï¼ˆæå‡é¡µé¢æ€§èƒ½ï¼‰
*   `nav`: è‡ªå®šä¹‰æ ‡ç­¾é¡µå¯¼èˆªæ çš„æ˜¾ç¤ºæ–‡æœ¬å’Œé¡ºåº

### 1.2 è¯„è®ºç³»ç»Ÿé…ç½®

æ¯ä¸ªè¯„è®ºç³»ç»Ÿå‡æœ‰ç‹¬ç«‹çš„é…ç½®åŒºå—ï¼Œéœ€æ ¹æ®å…·ä½“è¯„è®ºç³»ç»Ÿå¡«å†™å‚æ•°ã€‚

åŒæ ·è¿™äº›é…ç½®ä¹Ÿä½äº [\_config.yml](https://github.com/huazie/hexo-theme-diversity/blob/main/_config.yml) æ–‡ä»¶ä¸­ï¼Œè¯¦è§å¦‚ä¸‹ï¼š

**Utterance é…ç½®**

```yml
utterances:
  enable: false
  loading: true
  repo: user-name/repo-name
  issue_term: pathname
  theme: github-light
  dark: github-dark
```

**Gitalk é…ç½®**

```yml
gitalk:
  enable: false
  github_id: 
  repo: 
  client_id: 
  client_secret: 
  admin_user: 
  distraction_free_mode: true
  proxy: https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token
  issue_term: pathname
  language:
```

**Giscus é…ç½®**

```yml
giscus:
  enable: false
  loading: true
  repo: your-username/your-repo-name
  repo_id: 
  category: 
  category_id: 
  mapping: pathname
  term: 
  strict: 0
  reactions_enabled: 1
  emit_metadata: 0
  theme: light
  dark: dark
  lang: 
  input_position: bottom
  data_loading: lazy
```

é’ˆå¯¹ä¸Šè¿°ä¸‰ä¸ªè¯„è®ºç³»ç»Ÿçš„é…ç½®é¡¹è¯´æ˜ï¼Œéœ€è¦çš„æœ‹å‹è¯·ç¿»çœ‹ **Diversity ä¸»é¢˜é¡¹ç›®** çš„ [README](https://github.com/huazie/hexo-theme-diversity/blob/main/README.md) æ–‡ä»¶ã€‚

## 2. è¯„è®ºç³»ç»Ÿæ¸²æŸ“

è¯„è®ºç³»ç»Ÿçš„æ¸²æŸ“ç”± [comments.ejs](https://github.com/huazie/hexo-theme-diversity/blob/main/layout/_partial/comments.ejs) æ¨¡æ¿å¤„ç†ï¼Œè¯¥æ¨¡æ¿æ”¯æŒå•ä¸€å’Œå¤šä¸ªè¯„è®ºç³»ç»Ÿçš„é…ç½®ã€‚

![](comment-system-rendering.png)

### 2.1 å•è¯„è®ºç³»ç»Ÿ

å½“ä»…å¯ç”¨ä¸€ä¸ªè¯„è®ºç³»ç»Ÿæ—¶ï¼Œæ¨¡æ¿ä¼šç›´æ¥æ¸²æŸ“è¯¥è¯„è®ºç³»ç»Ÿï¼Œä¸æ˜¾ç¤ºæ ‡ç­¾é¡µã€‚åœ¨è¯„è®ºç³»ç»ŸåŠ è½½è¿‡ç¨‹ä¸­ï¼Œå¯é€‰æ‹©æ€§æ˜¾ç¤ºåŠ è½½æç¤ºç¬¦ã€‚

### 2.2 å¤šè¯„è®ºç³»ç»Ÿ

å½“å¯ç”¨å¤šä¸ªè¯„è®ºç³»ç»Ÿæ—¶ï¼Œæ¨¡æ¿ä¼šåˆ›å»ºå¸¦æ ‡ç­¾é¡µçš„äº¤äº’ç•Œé¢ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š

*   æ ‡ç­¾å¯¼èˆªæ ï¼šä¸ºæ¯ä¸ªå¯ç”¨çš„è¯„è®ºç³»ç»Ÿæä¾›åˆ‡æ¢æŒ‰é’®
*   æ ‡ç­¾å†…å®¹åŒºåŸŸï¼šåˆ†åˆ«åŠ è½½å„è¯„è®ºç³»ç»Ÿ
*   å¯é€‰åŠŸèƒ½ï¼šä¸ºæ¯ä¸ªè¯„è®ºç³»ç»Ÿæ˜¾ç¤ºç‹¬ç«‹åŠ è½½æç¤ºç¬¦
*   JavaScript è„šæœ¬ï¼šå¤„ç†æ ‡ç­¾é¡µåˆ‡æ¢é€»è¾‘åŠç”¨æˆ·åå¥½è®¾ç½®å­˜å‚¨

æ ‡ç­¾é¡µæ ·å¼ç”± [tabs.styl](https://github.com/huazie/hexo-theme-diversity/blob/main/source/css/_base/tabs.styl) ä¸­å®šä¹‰çš„ CSS æ§åˆ¶ï¼Œæ”¯æŒå¯¹æ¿€æ´»æ€ã€æ‚¬åœæ€å’Œæœªæ¿€æ´»æ€æä¾›è§†è§‰åé¦ˆã€‚

## 3. é›†æˆ Utterances

**Utterances** æ˜¯ä¸€æ¬¾å¼€æºçš„è¯„è®ºç³»ç»Ÿï¼Œå…¶é‡‡ç”¨ **GitHub Issues** ä½œä¸ºåç«¯å­˜å‚¨æœºåˆ¶ã€‚å½“è¯»è€…åœ¨æ‚¨çš„åšå®¢æ–‡ç« ä¸‹æ–¹ç•™è¨€æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨æ‚¨æŒ‡å®šçš„ä»£ç ä»“åº“ä¸­åˆ›å»ºæˆ–å›å¤ **GitHub Issues**ã€‚

![](utterances-comment-system.png)

### 3.1 å·¥ä½œæµç¨‹

ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€å¹…æµç¨‹ç¤ºæ„å›¾ï¼Œæ¥è¯¦ç»†æè¿° **Utterances** è¯„è®ºç³»ç»Ÿä»é…ç½®åˆ°æ˜¾ç¤ºçš„å®Œæ•´å·¥ä½œæµç¨‹ã€é…ç½®æ–‡ä»¶ â†’ å‰ç«¯é€»è¾‘ â†’ API äº¤äº’ â†’ ç•Œé¢æ¸²æŸ“ã€‘ï¼Œå¦‚ä¸‹ï¼š

![](utterances-architecture.png)

### 3.2 åŠ è½½ä¸è¿è¡Œæœºåˆ¶

`Utterances` çš„åŠ è½½æµç¨‹éµå¾ªä»¥ä¸‹æ­¥éª¤ã€è¯¦ç»†æŸ¥çœ‹ [source/js/third-party/comments/utterances.js](https://github.com/huazie/hexo-theme-diversity/blob/main/source/js/third-party/comments/utterances.js)ã€‘ï¼š

1.  **è§¦å‘åŠ è½½**ï¼šé¡µé¢åŠ è½½æ—¶ï¼Œäº‹ä»¶ç›‘å¬å™¨è§¦å‘ `loadUtterances()` å‡½æ•°
2.  **çŠ¶æ€æç¤º**ï¼šæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
3.  **å®¹å™¨å‡†å¤‡**ï¼šé€šè¿‡ `Diversity.utils.loadComments()` å·¥å…·æ–¹æ³•åˆå§‹åŒ–è¯„è®ºå®¹å™¨
4.  **è„šæœ¬åŠ è½½**ï¼šä» `_config.yml` è¯»å–é…ç½®å‚æ•°ï¼ŒåŠ¨æ€åŠ è½½ **Utterances** è„šæœ¬
5.  **æ•°æ®è·å–**ï¼š**Utterances** ä¸ **GitHub API** é€šä¿¡ï¼ŒåŠ è½½å½“å‰é¡µé¢å¯¹åº”çš„è¯„è®ºæ•°æ®
6.  **å®Œæˆå¤„ç†**ï¼šåŠ è½½å®Œæˆåï¼Œ**Utterances** å‘é€ `resize` æ¶ˆæ¯ã€‚ä¸»é¢˜æ•è·è¯¥æ¶ˆæ¯å¹¶éšè—åŠ è½½æŒ‡ç¤ºå™¨

![](utterances-loading-process.png)

### 3.3 æ¶‰åŠä»£ç 

**æ·»åŠ  Utterances è¯„è®ºç³»ç»Ÿç›¸å…³çš„Diversityä¸»é¢˜æ³¨å…¥è¿‡æ»¤å™¨**

```js
'use strict';

const path = require('path');

// æ·»åŠ  Utterances è¯„è®ºç³»ç»Ÿç›¸å…³çš„Diversityä¸»é¢˜æ³¨å…¥è¿‡æ»¤å™¨
hexo.extend.filter.register('theme_inject', injects => {
    const config = hexo.theme.config.utterances;
    // æ²¡æœ‰å¯ç”¨ Utterances
    if (!config.enable) return;

    // æ²¡æœ‰é…ç½®GitHubä»“åº“æ‰€æœ‰è€…å’Œåç§°
    if (!config.repo) {
        hexo.log.error('utterances.repo can\'t be null.');
        return;
    }

    // comment è§†å›¾æ·»åŠ  utterances
    injects.comment.raw('utterances', '<div class="comments utterances-container"></div>', {}, { cache: true });

    // pageEnd è§†å›¾æ·»åŠ  utterances
    injects.pageEnd.file('utterances', path.join(hexo.theme_dir, 'layout/_third-party/comments/utterances.ejs'));
});
```

è¿™é‡Œä¸»è¦åšä¸¤ä»¶äº‹ï¼š

*   å¾€ `comment` è§†å›¾æ·»åŠ  **utterances** çš„ `div` å±‚ã€‚è¿™é‡Œå¯ä»¥é€šè¿‡  [comments.ejs](https://github.com/huazie/hexo-theme-diversity/blob/main/layout/_partial/comments.ejs) æ¨¡æ¿æŸ¥çœ‹å¦‚ä¸‹ä»£ç ã€å…¶ä¸­ `inject_item` å°±æ˜¯ `injects.comment` ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‘ï¼š

```ejs
<%- partial(inject_item.layout, inject_item.locals, inject_item.options) %>
```

*   å¾€ `pageEnd` è§†å›¾æ·»åŠ  **utterances** å¸ƒå±€ã€‚è¿™é‡Œä¹Ÿæ˜¯æŸ¥çœ‹ [comments.ejs](https://github.com/huazie/hexo-theme-diversity/blob/main/layout/_partial/comments.ejs)ä¸­çš„ä»£ç ï¼š

```ejs
<%- diversity_inject('pageEnd') %>
```

**Utterances å¸ƒå±€**

```ejs
<%- diversity_data('utterances', theme.utterances, {
  js : 'https://utteranc.es/client.js'
}) %>
<%- js('js/third-party/comments/utterances') %>
```

è¿™é‡ŒåŠ è½½ä¸¤éƒ¨åˆ†å†…å®¹ï¼š

*   `Utterances` çš„è¯„è®ºç³»ç»Ÿé…ç½®ã€å‚è§**1.2**ä¸­çš„å†…å®¹ã€‘
*   `Utterances` è¯„è®ºç³»ç»ŸåŠ è½½ä¸è¿è¡Œçš„è„šæœ¬æ–‡ä»¶ã€å‚è§**3.2**ä¸­çš„å†…å®¹ã€‘

## 4. é›†æˆ Gitalk

**Gitalk** åŒæ ·é‡‡ç”¨ **GitHub Issues** ä½œä¸ºè¯„è®ºå­˜å‚¨çš„åç«¯ç³»ç»Ÿã€‚å½“æ­£ç¡®é…ç½®åï¼Œæˆ‘ä»¬åšå®¢ä¸­çš„æ¯ä¸ªé¡µé¢éƒ½ä¼šè‡ªåŠ¨å…³è”åˆ°ä¸€ä¸ª **GitHub Issue**ï¼Œæ‰€æœ‰è¯„è®ºå°†å­˜å‚¨å¹¶ç®¡ç†åœ¨è¯¥ **Issue** ä¸­ã€‚

![](gitalk-comment-system.png)

### 4.1 å·¥ä½œæµç¨‹

å¦‚ä¸‹æ˜¯ä¸€å¹…æè¿° **Gitalk è¯„è®ºç³»ç»Ÿå·¥ä½œæµç¨‹** çš„äº¤äº’æ—¶åºå›¾ï¼Œå±•ç¤ºäº†ä»ç”¨æˆ·è®¿é—®åˆ°è¯„è®ºåŠ è½½çš„å®Œæ•´é—­ç¯è¿‡ç¨‹ã€‚

![](gitalk-sequence-diagram.png)

### 4.2 åŠ è½½ä¸è¿è¡Œæœºåˆ¶

![](gitalk-loading-process.png)

`Gitalk` çš„åŠ è½½æµç¨‹éµå¾ªä»¥ä¸‹æ­¥éª¤ã€è¯¦ç»†æŸ¥çœ‹ [source/js/third-party/comments/gitalk.js](https://github.com/huazie/hexo-theme-diversity/blob/main/source/js/third-party/comments/gitalk.js)ã€‘ï¼š

1.  **è§¦å‘åŠ è½½** ï¼šå½“é¡µé¢åŠ è½½å®Œæˆï¼ˆ`page:loaded` äº‹ä»¶ï¼‰æˆ–åˆ‡æ¢é…è‰²æ–¹æ¡ˆï¼ˆ`color-scheme:refresh` äº‹ä»¶ï¼‰æ—¶ï¼Œè§¦å‘ `loadGitalk()` å‡½æ•°ã€‚

2.  **å®¹å™¨å‡†å¤‡** ï¼šè°ƒç”¨ `Diversity.utils.loadComments('.gitalk-container')` åˆå§‹åŒ– **Gitalk** è¯„è®ºå®¹å™¨ï¼ˆ`.gitalk-container` å…ƒç´ ï¼‰ã€‚

3.  **è„šæœ¬åŠ è½½** ï¼šåŠ¨æ€åŠ è½½ **Gitalk** è„šæœ¬ï¼ˆ`gitalk.js`ï¼‰ï¼Œé€šè¿‡ `Diversity.utils.getScript()` æ³¨å…¥ï¼Œå¹¶æ£€æŸ¥å…¨å±€å˜é‡ `window.Gitalk` æ˜¯å¦å·²å­˜åœ¨ï¼ˆé¿å…é‡å¤åŠ è½½ï¼‰ã€‚

4.  **ç”Ÿæˆ Issue æ ‡è¯†** ï¼šæ ¹æ® `_config.yml` ä¸­çš„ `issue_term` é…ç½®ï¼Œç”Ÿæˆå”¯ä¸€æ ‡è¯† `gitalkId`ï¼š
    *   **`pathname`**ï¼šä½¿ç”¨å½“å‰é¡µé¢çš„è·¯å¾„ï¼ˆå¦‚ `/posts/hello-world`ï¼‰ã€‚
    *   **`url`**ï¼šä½¿ç”¨å®Œæ•´é¡µé¢ URLï¼ˆå«åŸŸåï¼‰ã€‚
    *   **`title`**ï¼šä½¿ç”¨é¡µé¢æ ‡é¢˜ï¼ˆ`document.title`ï¼‰ã€‚
    *   **è‡ªå®šä¹‰æ•°å­—**ï¼šè‹¥é…ç½®ä¸ºæ•°å­—ï¼ˆå¦‚ `42`ï¼‰ï¼Œç›´æ¥èµ‹å€¼ç»™ `number` å˜é‡ã€‚

> ğŸ“Œ **æ—¥å¿—è¾“å‡º**ï¼šè‹¥ `gitalkId` æœ‰æ•ˆï¼Œæ§åˆ¶å°ä¼šæ‰“å°æ—¥å¿—ï¼ˆå¦‚ `"GitHub issue label is [/posts/hello-world]"`ï¼‰ã€‚

5.  **åˆå§‹åŒ– Gitalk å®ä¾‹**
    *   ä» `_config.yml` è¯»å–é…ç½®å‚æ•°ï¼Œæ„å»º `confgObj` å¯¹è±¡ï¼š
        *   **GitHub OAuth è®¤è¯**ï¼š`clientID` å’Œ `clientSecret`ã€‚
        *   **ä»“åº“ä¿¡æ¯**ï¼š`repo`ï¼ˆä»“åº“åï¼‰ã€`owner`ï¼ˆGitHub ç”¨æˆ·åï¼‰ã€‚
        *   **ç®¡ç†å‘˜**ï¼š`admin` æŒ‡å®šå¯ç®¡ç†è¯„è®ºçš„ GitHub ç”¨æˆ·ã€‚
        *   **å”¯ä¸€æ ‡è¯†**ï¼š`id`ï¼ˆåŸºäº `gitalkId`ï¼‰æˆ– `number`ï¼ˆè‡ªå®šä¹‰ Issue ç¼–å·ï¼‰ã€‚
        *   **ä»£ç†é…ç½®**ï¼š`proxy`ï¼ˆç”¨äºç»•è¿‡ CORSï¼Œå¯é€‰ï¼‰ã€‚
        *   **æ— å¹²æ‰°æ¨¡å¼**ï¼š`distractionFreeMode`ï¼ˆéšè—æ— å…³æŒ‰é’®ï¼‰ã€‚
        *   **è¯­è¨€**ï¼š`language`ï¼ˆè‹¥é…ç½®ï¼‰ã€‚

    *   åˆ›å»º **Gitalk** å®ä¾‹å¹¶æ¸²æŸ“åˆ°å®¹å™¨ï¼š
    ```javascript
    const gitalk = new Gitalk(confgObj);
    gitalk.render(document.querySelector('.gitalk-container'));
    ```

6.  **æ•°æ®è·å–ä¸æ¸²æŸ“** ï¼š**Gitalk** é€šè¿‡ **GitHub API** è®¿é—®æŒ‡å®šä»“åº“çš„ **Issues**ï¼š
    *   æ ¹æ® `id` æˆ– `number` åŒ¹é…å¯¹åº”çš„ Issueï¼ˆä¸å­˜åœ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰ã€‚
    *   åŠ è½½è¯¥ **Issue** ä¸‹çš„è¯„è®ºæ•°æ®å¹¶æ¸²æŸ“åˆ°é¡µé¢ã€‚

> âš ï¸ **æ³¨æ„**ï¼šè‹¥ `proxy` æœªé…ç½®ï¼Œå¯èƒ½å› \*\* GitHub API\*\* çš„ **CORS** é™åˆ¶å¯¼è‡´åŠ è½½å¤±è´¥ã€‚

### 4.3 GitHub OAuth åº”ç”¨é…ç½®

æˆ‘ä»¬è¦ä½¿ç”¨ **Gitalk**ï¼Œéœ€è¦åˆ›å»º **GitHub OAuth** åº”ç”¨ï¼Œå¹¶ç”¨å®ƒæ¥è¿›è¡Œæˆæƒ **Gitalk** è®¿é—® **Github Issues**ã€‚

æœ‰å…³å†…å®¹ï¼Œç½‘ä¸Šå¾ˆå¤šï¼Œåç»­æœ‰æ—¶é—´ **Huazie** ä¸“é—¨å†™ç¯‡é…ç½®æŒ‡å—ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚

### 4.4 æ¶‰åŠä»£ç 

**æ·»åŠ  Gitalk è¯„è®ºç³»ç»Ÿç›¸å…³çš„Diversityä¸»é¢˜æ³¨å…¥è¿‡æ»¤å™¨**

```js
'use strict';

const path = require('path');

// æ·»åŠ  Gitalk è¯„è®ºç³»ç»Ÿç›¸å…³çš„Diversityä¸»é¢˜æ³¨å…¥è¿‡æ»¤å™¨
hexo.extend.filter.register('theme_inject', injects => {
    const config = hexo.theme.config.gitalk;
    // æ²¡æœ‰å¯ç”¨ Gitalk
    if (!config.enable) return;

    // æ²¡æœ‰é…ç½®GitHub ä»“åº“æ‰€æœ‰è€…
    if (!config.repo) {
        hexo.log.error('gitalk.repo can\'t be null.');
        return;
    }

    // æ²¡æœ‰é…ç½®GitHub ä»“åº“æ‰€æœ‰è€…
    if (!config.github_id) {
        hexo.log.error('gitalk.github_id can\'t be null.');
        return;
    }

    // æ²¡æœ‰é…ç½®GitHub åº”ç”¨å®¢æˆ·ç«¯ ID
    if (!config.client_id) {
        hexo.log.error('gitalk.client_id can\'t be null.');
        return;
    }

    // æ²¡æœ‰é…ç½®GitHub åº”ç”¨å®¢æˆ·ç«¯å¯†é’¥
    if (!config.client_secret) {
        hexo.log.error('gitalk.client_secret can\'t be null.');
        return;
    }
 
    // comment è§†å›¾æ·»åŠ  gitalk
    injects.comment.raw('gitalk', '<div class="comments gitalk-container"></div>', {}, { cache: true });

    // pageEnd è§†å›¾æ·»åŠ  gitalk
    injects.pageEnd.file('gitalk', path.join(hexo.theme_dir, 'layout/_third-party/comments/gitalk.ejs'));
});
```

è¿™é‡Œä¹Ÿæ˜¯ä¸»è¦åšä¸¤ä»¶äº‹ï¼š

*   å¾€ `comment` è§†å›¾æ·»åŠ  **gitalk** çš„ `div` å±‚ã€‚
*   å¾€ `pageEnd` è§†å›¾æ·»åŠ  **gitalk** å¸ƒå±€ã€‚

**Gitalk å¸ƒå±€**

```ejs
<%- css('https://unpkg.com/gitalk/dist/gitalk.css') %>
<style>.gt-container .gt-comment-body { color: var(--text-color) !important; }</style>
<%- diversity_data('gitalk', theme.gitalk, {
  js : 'https://unpkg.com/gitalk/dist/gitalk.min.js'
}) %>
<%- js('js/third-party/comments/gitalk') %>
```

è¿™é‡ŒåŠ è½½ä¸‰éƒ¨åˆ†å†…å®¹ï¼š

*   `Gitalk` çš„ **CSS** æ ·å¼æ–‡ä»¶å’Œè‡ªå®šä¹‰æ ·å¼éƒ¨åˆ†
*   `Gitalk` çš„è¯„è®ºç³»ç»Ÿé…ç½®ã€å‚è§**1.2**ä¸­çš„å†…å®¹ã€‘
*   `Gitalk` è¯„è®ºç³»ç»ŸåŠ è½½ä¸è¿è¡Œçš„è„šæœ¬æ–‡ä»¶ã€å‚è§**4.2**ä¸­çš„å†…å®¹ã€‘

## 5. é›†æˆ Giscus

**Giscus** å’Œä¸Šè¿°ä¿©ä¸ªè¯„è®ºç³»ç»Ÿä¸ä¸€æ ·ï¼Œå®ƒæ˜¯åˆ©ç”¨ **GitHub Discussions** åŠŸèƒ½æ¥å­˜å‚¨å’Œç®¡ç†æ‰€æœ‰è¯„è®ºã€‚

### 5.1 å·¥ä½œæµç¨‹

å¦‚ä¸‹æ˜¯ä¸€å¹…æè¿° **Giscus è¯„è®ºç³»ç»Ÿçš„äº¤äº’æ—¶åºå›¾**ï¼Œå±•ç¤ºäº†ç”¨æˆ·ã€åšå®¢é¡µé¢ã€**Giscus** è„šæœ¬å’Œ **GitHub Discussions** ä¹‹é—´çš„äº¤äº’æµç¨‹ã€‚

![](giscus-sequence-diagram.png)

### 5.2 åŠ è½½ä¸è¿è¡Œæœºåˆ¶

`Giscus` çš„åŠ è½½æµç¨‹éµå¾ªä»¥ä¸‹æ­¥éª¤ã€è¯¦ç»†æŸ¥çœ‹ [source/js/third-party/comments/giscus.js](https://github.com/huazie/hexo-theme-diversity/blob/main/source/js/third-party/comments/giscus.js)ã€‘ï¼š

1.  **è§¦å‘åŠ è½½** ï¼šå½“é¡µé¢åŠ è½½å®Œæˆï¼ˆ`page:loaded` äº‹ä»¶ï¼‰æˆ–åˆ‡æ¢é…è‰²æ–¹æ¡ˆï¼ˆ`color-scheme:refresh` äº‹ä»¶ï¼‰æ—¶ï¼Œè§¦å‘ `loadGiscus()` å‡½æ•°ã€‚

2.  **çŠ¶æ€æç¤º** ï¼šæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ï¼ˆ`loadingElement` ç§»é™¤ `hidden` ç±»ï¼‰ã€‚

3.  **å®¹å™¨å‡†å¤‡** ï¼šè°ƒç”¨ `Diversity.utils.loadComments('.giscus')` åˆå§‹åŒ– **Giscus** è¯„è®ºå®¹å™¨ï¼ˆ`.giscus` å…ƒç´ ï¼‰ã€‚

4.  **è„šæœ¬åŠ è½½**
    *   ä» `_config.yml` è¯»å– **Giscus** é…ç½®å‚æ•°ï¼ˆå¦‚ `repo`ã€`category`ã€`theme` ç­‰ï¼‰ã€‚
    *   åŠ¨æ€åŠ è½½ **Giscus** è„šæœ¬ï¼ˆ`giscus.js`ï¼‰ï¼Œå¹¶æ³¨å…¥ä»¥ä¸‹å±æ€§ï¼š
        *   **GitHub** ä»“åº“ä¿¡æ¯ï¼ˆ`data-repo`ã€`data-repo-id`ï¼‰ã€‚
        *   **Discussions** åˆ†ç±»ï¼ˆ`data-category`ã€`data-category-id`ï¼‰ã€‚
        *   ä¸»é¢˜æ˜ å°„ï¼ˆ`data-mapping`ï¼‰å’Œé¡µé¢åŒ¹é…è§„åˆ™ï¼ˆ`data-term`ï¼‰ã€‚
        *   ç•Œé¢é…ç½®ï¼ˆè¯­è¨€ `data-lang`ã€è¾“å…¥æ¡†ä½ç½® `data-input-position` ç­‰ï¼‰ã€‚
        *   åŠ¨æ€ä¸»é¢˜ï¼ˆæ ¹æ® `isDarkMode()` åˆ‡æ¢ `data-theme`ï¼‰ã€‚

5.  **æ•°æ®è·å–**
    *   **Giscus** è„šæœ¬é€šè¿‡ **GitHub API** è¿æ¥å…³è”çš„ **Discussions** ä»“åº“ã€‚
    *   æ ¹æ®å½“å‰é¡µé¢çš„ **URL** æˆ– `data-term` è§„åˆ™åŒ¹é…å¯¹åº”çš„ **Discussion**ï¼ŒåŠ è½½è¯„è®ºæ•°æ®ã€‚

6.  **å®Œæˆå¤„ç†**
    *   **Giscus** çš„ **iframe** åŠ è½½å®Œæˆåï¼Œé€šè¿‡ `window.postMessage` å‘é€æ¶ˆæ¯ï¼ˆ`e.data.giscus`ï¼‰ã€‚
    *   ä¸»é¢˜æ•è·è¯¥æ¶ˆæ¯ï¼Œéšè—åŠ è½½æŒ‡ç¤ºå™¨ï¼ˆ`loadingElement` æ·»åŠ  `hidden` ç±»ï¼‰ã€‚

### 5.3 æ¶‰åŠä»£ç 

**æ·»åŠ  Giscus è¯„è®ºç³»ç»Ÿç›¸å…³çš„Diversityä¸»é¢˜æ³¨å…¥è¿‡æ»¤å™¨**

```js
'use strict';

const path = require('path');

// æ·»åŠ  Giscus è¯„è®ºç³»ç»Ÿç›¸å…³çš„Diversityä¸»é¢˜æ³¨å…¥è¿‡æ»¤å™¨
hexo.extend.filter.register('theme_inject', injects => {
    const config = hexo.theme.config.giscus;
    // æ²¡æœ‰å¯ç”¨ Giscus
    if (!config.enable) return;

    // æ²¡æœ‰é…ç½®GitHubä»“åº“åç§°
    if (!config.repo) {
        hexo.log.error('giscus.repo can\'t be null.');
        return;
    }

    // comment è§†å›¾æ·»åŠ  giscus
    injects.comment.raw('giscus', '<div class="comments giscus-container"><div class="giscus"></div></div>', {}, { cache: true });

    // pageEnd è§†å›¾æ·»åŠ  giscus
    injects.pageEnd.file('giscus', path.join(hexo.theme_dir, 'layout/_third-party/comments/giscus.ejs'));
});
```

è¿™é‡Œä¸»è¦åšä¸¤ä»¶äº‹ï¼š

*   å¾€ `comment` è§†å›¾æ·»åŠ  **giscus** çš„ `div` å±‚ã€‚
*   å¾€ `pageEnd` è§†å›¾æ·»åŠ  **giscus** å¸ƒå±€ã€‚

**Giscus å¸ƒå±€**

```ejs
<%- diversity_data('giscus', theme.giscus, {
  js : 'https://giscus.app/client.js'
}) %>
<%- js('js/third-party/comments/giscus') %>
```

è¿™é‡ŒåŠ è½½ä¸¤éƒ¨åˆ†å†…å®¹ï¼š

*   `Giscus` çš„è¯„è®ºç³»ç»Ÿé…ç½®ã€å‚è§**1.2**ä¸­çš„å†…å®¹ã€‘
*   `Giscus` è¯„è®ºç³»ç»ŸåŠ è½½ä¸è¿è¡Œçš„è„šæœ¬æ–‡ä»¶ã€å‚è§**5.2**ä¸­çš„å†…å®¹ã€‘

# ğŸ–¥ï¸ å±•ç¤ºæ•ˆæœ

## 1. å•è¯„è®ºç³»ç»Ÿå±•ç¤º

![](utterances-show-1.png)

## 2. å¤šè¯„è®ºç³»ç»Ÿå±•ç¤º

![](utterances-show.png)

![](gitalk-show.png)

![](giscus-show.png)

# ğŸ“ˆ åç»­ç›®æ ‡

é›†æˆæ›´å¤šçš„è¯„è®ºç³»ç»Ÿï¼Œæ¯”å¦‚ï¼š

*   `Gitment` ï¼šä¸€æ¬¾åŸºäº **GitHub Issues** çš„è½»é‡çº§è¯„è®ºç³»ç»Ÿï¼Œç”±å¼€å‘è€… **imsun** å¼€å‘ï¼Œæ— éœ€åç«¯ä»£ç å³å¯é›†æˆåˆ°ç½‘é¡µä¸­ï¼Œå°¤å…¶é€‚åˆé™æ€åšå®¢ï¼ˆå¦‚ **GitHub Pages**ï¼‰æˆ–æŠ€æœ¯æ–‡æ¡£ç«™ç‚¹ã€‚
*   `Vssue` ï¼šæ”¯æŒå¤šå¹³å°ï¼ˆ**GitHub**ã€**GitLab** ç­‰ï¼‰ï¼Œé€‚åˆå¤šä»£ç æ‰˜ç®¡ç”¨æˆ·ã€‚

å½“ç„¶ï¼Œå¦‚æœè¿˜æœ‰å…¶ä»–è¯„è®ºç³»ç»Ÿï¼Œä¸ç®¡æ˜¯ä¸æ˜¯åŸºäº **GitHub Issues** ï¼Œéƒ½å¯ä»¥ä½œä¸ºåç»­æ›´æ–°è€ƒè™‘ï¼Œæ¬¢è¿å¤§å®¶è¯„è®ºåŒºè¡¥å……å“ˆï¼

å¦å¤–ï¼Œæ ‡ç­¾é¡µå±•ç¤ºå¤šä¸ªè¯„è®ºç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥åç»­æ”¯æŒä¸‹æ‹‰æ¡†é€‰æ‹©è¯„è®ºç³»ç»Ÿï¼›

# ğŸ“ ç»“è¯­

**Diversity** ä¸»é¢˜æä¾›çµæ´»æ˜“ç”¨çš„è¯„è®ºç³»ç»Ÿé›†æˆæ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆæ·±å— [NexT](url) ä¸»é¢˜å¯å‘ï¼Œä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š

*   **å¤šå¹³å°æ”¯æŒ**ï¼šå…¼å®¹ `Utterances`ã€`Gitalk` å’Œ `Giscus` è¯„è®ºç³»ç»Ÿ
*   **æ ‡ç­¾é¡µäº¤äº’**ï¼šæ”¯æŒå¤šè¯„è®ºç³»ç»Ÿæ ‡ç­¾é¡µåˆ‡æ¢ç•Œé¢
*   **åå¥½è®°å¿†åŠŸèƒ½**ï¼šè‡ªåŠ¨ä¿å­˜ç”¨æˆ·é€‰æ‹©çš„è¯„è®ºç³»ç»Ÿåå¥½
*   **åŠ è½½çŠ¶æ€æç¤º**ï¼šå¢å¼ºç”¨æˆ·ä½“éªŒçš„åŠ è½½æŒ‡ç¤ºå™¨
*   **å¯å®šåˆ¶åŒ–é…ç½®**ï¼šæ”¯æŒå¯¼èˆªæ–‡æœ¬è‡ªå®šä¹‰ä¸æ’åºè°ƒæ•´

ä½ è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Œèµ¶å¿«æ¥æ¥å…¥ **Diversity** ä¸»é¢˜æ¥ä½“éªŒä½“éªŒå§ï¼

æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿æ¥è¯„è®ºåŒºå’Œæˆ‘äº’åŠ¨å“¦ï¼
